# Stripe Django Checkout (Session API)

Этот проект демонстрирует интеграцию платежной системы Stripe через Checkout Session с поддержкой:

- оплаты отдельных товаров (Item);

- оформления заказов (Order) с несколькими товарами;

- поддержки скидок, налогов и мультивалютности.

### Эндпоинты
| URL                      | Назначение                                                                                |
|--------------------------|-------------------------------------------------------------------------------------------|
| `/item/<id>/`            | Страница товара с описанием и кнопкой оплаты через Stripe.                                |
| `/buy/<id>/`             | AJAX-эндпоинт для создания Stripe Checkout Session по товару. Возвращает `session.id`.    |
| `/order/<id>/`           | Страница заказа со списком всех товаров, скидками и налогами. Кнопка оплаты заказа.       |
| `/buy_order/<id>/`       | AJAX-эндпоинт для создания Stripe Checkout Session по заказу (с учётом скидок и налогов). |
| `/success/`              | Страница, отображаемая после успешной оплаты.                                             |
| `/cancel/`               | Страница, отображаемая после отмены оплаты.                                               |
| `/supersecretadminpage/` | Панель администратора Django.                                                             |


### Переменные окружения
В stripe_test_task/.env заполните:

| Переменная                  | Назначение                                                                                                                         |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| STRIPE_SECRET_KEY           | Секретный ключ Stripe (тестовый).                                                                                                  |
| STRIPE_PUBLISHABLE_KEY      | Публичный ключ Stripe (тестовый).                                                                                                  |
| DJANGO_SECRET_KEY           | Секретный ключ Django.                                                                                                             |
| DEBUG                       | Переменная DEBUG Django (True/False).                                                                                              |
| DJANGO_ALLOWED_HOSTS        | Список хостов для развёртывания для Django (через запятую).                                                                        |
| DJANGO_CSRF_TRUSTED_ORIGINS | Список доверенных источников CSRF для Django (через запятую, с протоколом ('https://'), может быть аналогичен предыдущему пункту). |
| DATABASE_ENGINE             | Движок СУБД (postgresql_psycopg2 для PostgreSQL).                                                                                  |
| DATABASE_NAME               | Имя БД.                                                                                                                            |
| DATABASE_USERNAME           | Имя пользователя для БД.                                                                                                           |
| DATABASE_PASSWORD           | Пароль для БД.                                                                                                                     |
| DATABASE_HOST               | Хост для БД.                                                                                                                       |
| DATABASE_PORT               | Порт для БД (5432 для PostgreSQL).                                                                                                 |

### Запуск
Перейдите в каталог `stripe_test_task`:
```bash
cd stripe_test_task/
```

Выполните сборку Docker Compose:
```bash
docker compose up --build
```

Далее при успешной сборке и запуске контейнеров создайте суперпользователя:
```bash
docker exec -it django_docker bash
```
```bash
python3 manage.py createsuperuse
```

Теперь настройте порты и фаервол, и приложение будет готово к использованию. 